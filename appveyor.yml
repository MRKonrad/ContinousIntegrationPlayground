# version string format -- This will be overwritten later anyway
version: "{build}"

os:
  - Visual Studio 2017
#  - Visual Studio 2015

init:
  - git config --global core.autocrlf input
  # Set build version to git commit-hash
  - ps: Update-AppveyorBuild -Version "$($env:APPVEYOR_REPO_BRANCH) - $($env:APPVEYOR_REPO_COMMIT)"

install:
  - git submodule update --init --recursive

platform:
#  - Win32
  - x64

configuration:
#  - Debug
  - Release

before_build:
  - cmake . -Bbin -A%PLATFORM%

build:
  project: bin\ContinousIntegrationPlayground.sln  # path to Visual Studio solution or project
  parallel: true                                   # enable MSBuild parallel builds
  verbosity: normal                                # MSBuild verbosity level {quiet|minimal|normal|detailed}

test_script:
  - cd bin
  - ctest -V -j2 -C %CONFIGURATION%

before_deploy:
  - echo "Ready to deploy?"
  - echo ${APPVEYOR_BUILD_FOLDER}
  - echo ${PLATFORM}
  - echo ${APPVEYOR_REPO_BRANCH}
  - echo ${APPVEYOR_REPO_TAG_NAME}
  - echo ${CONFIGURATION}

  - cd ${TRAVIS_BUILD_DIR}
#  - chmod -x ContinousIntegrationPlaygroundExe
#  - mkdir deployment
#  - cp ContinousIntegrationPlaygroundExe deployment/ContinousIntegrationPlaygroundExe_$TRAVIS_BRANCH_$TRAVIS_OS_NAME
deploy:
#  release: ContinousIntegrationPlayground-v$(appveyor_build_version)
#  description: 'Release description'
  provider: GitHub
  auth_token:
    secure: hktHPt7mF39LVJhyABALXqMLv0XSrifhYSqi3pV/1shHgsNvMSx63igUKMZBZPnuxsclV8i0PGxKZxScu2Mh28PFJtyfEcD1W+FZURmOS9Fr3FhvlNuiH4SEbVacc0sS8DJEsV8uCeJZj/+cIJMFDmuEiKuSaGNTpFykh8gxJE2tHL7nkijOFUl7PDHWOE7oTGaYd+N0vntk5E26dZ8W8rDDcf8iKhxkGM8wyqDKgrZyp53a6AoadhxrPwUyoM0zuiQWp8pzQAyGMp828dWDxl+NJ/tpz/XtdKMJrLtiD+4ecVHg9gX37r86pTOpfTLDeedfPwIGhjja03G/ED9ZqgySnT3aEdpwae9WQfH6rYmCwg/RKvmnI1y9cFINO8hxwx/GcgusvIibkiKJqPamKkHBTTN9qbHipXXZj+KupPN8Qf0xj8sZRqYEV9eJQaBjKLw8dbi93JtpPRepBmCL8+jGZ7mCDZEJBeUDhXksAMTuecsR2UeKX9+2IydZpj1oEDsgVsL8kC3m1DR2mAZUdxCrjIcwjhosyUNO3GHqKkpnmRkqnF9zPEglPs4RuE8gTGTskpOPd0E/0wQRQAlcCZaCxgrt5a2t7d4qHz4fy7cKeM7nt73eW11I4/ZLgYiXcFk9T7dJuqtHFqOWpi64tV8NYtibbamib9D07zmhiS0=
  artifact: bin\tests\Release\ContinousIntegrationPlaygroundTests.exe
  draft: false
  prerelease: false
  on:
    appveyor_repo_tag: true        # deploy on tag push only
    platform: x64
    configuration: Release